---
# OpenClaw Migration to Ansible - SUPER FINAL VERSION
# Tanpa Jinja2 filters, idempotent, safe

- name: OpenClaw Migration to Ansible
  hosts: localhost
  gather_facts: true
  become: false
  vars:
    workspace_dir: "/home/ardinusawan/.openclaw/workspace"
    backup_dir: "/tmp/openclaw_migration_backup"
    migrate: false  # Set to true to actually perform migration

  pre_tasks:
    - name: Migration | Display Banner
      debug:
        msg: "OpenClaw Migration to Ansible - From: Manual Scripts, To: Ansible Automation"

    - name: Migration | Check Ansible Installation
      command: ansible --version
      register: ansible_version
      failed_when: false
      changed_when: false

    - name: Migration | Display Ansible Version
      debug:
        msg: "Ansible Version: {{ ansible_version.stdout | default('Not installed') }}"

    - name: Migration | Create Backup Directory
      file:
        path: "{{ backup_dir }}"
        state: directory
        mode: '0755'

  roles:
    - role: openclaw.backup
      when: migrate

    - role: openclaw.migrate
      when: migrate

    - role: openclaw.verify
      when: migrate

  tasks:
    - name: Migration | Complete
      debug:
        msg: "Migration Status: {{ 'COMPLETE (with backup)' if migrate else 'DRY RUN (no changes)' }}"
